---
title: "Data_Generating"
output: html_document
date: "2025-04-25"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

## Data Generation

```{r}
generate_data <- function(n = 250, effect_type = "homogeneous", response_surface = "linear") {
  set.seed(123) # For reproducibility
  
  # Step 1: Generate covariates
  X1 <- rnorm(n)
  X2 <- rnorm(n)
  X3 <- rnorm(n)
  X4 <- rbinom(n, 1, 0.5)
  X5 <- sample(1:3, n, replace = TRUE)
  
  # Step 2: Define g(X4)
  g_X4 <- ifelse(X4 == 0, 2, -1)
  
  # Step 3: Compute prognostic function mu(x)
  if (response_surface == "linear") {
    mu <- 1 + g_X4 + X1 * X3
  } else if (response_surface == "nonlinear") {
    mu <- -6 + g_X4 + 6 * abs(X3 - 1)
  } else {
    stop("Invalid response_surface type. Choose 'linear' or 'nonlinear'.")
  }
  
  # Step 4: Compute s (standard deviation of mu)
  s <- sd(mu)
  
  # Step 5: Generate random noise for propensity score
  u <- runif(n)
  
  # Step 6: Compute propensity score
  pi_x <- 0.8 * pnorm(3 * mu / s - 0.5 * X1) + 0.05 + u / 10
  pi_x <- pmin(pmax(pi_x, 0), 1) # Truncate between 0 and 1 if necessary
  
  # Step 7: Assign treatment
  Z <- rbinom(n, 1, pi_x)
  
  # Step 8: Define treatment effect tau(x)
  if (effect_type == "homogeneous") {
    tau <- rep(3, n)
  } else if (effect_type == "heterogeneous") {
    tau <- 1 + 2 * X2 * (X5 == 1)
  } else {
    stop("Invalid effect_type. Choose 'homogeneous' or 'heterogeneous'.")
  }
  
  # Step 9: Generate outcomes
  epsilon <- rnorm(n)
  Y <- mu + tau * Z + epsilon
  
  # Step 10: Return a data.frame
  data.frame(Y, Z, X1, X2, X3, X4, X5, mu, tau, pi_x)
}
```

```{r}
df1 <- generate_data(n = 250, effect_type = "homogeneous", response_surface = "linear")
head(df1)
```

## Including Plots

You can also embed plots, for example:

```{r pressure, echo=FALSE}
plot(pressure)
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
